---
title:
author:    "Daniel Morillo"
institute: "CIBERSAM"
date:      "`r format(lubridate::today(), '%d de %B de %Y')`"
output:
  revealjs::revealjs_presentation:
    mathjax:         null
    transition:      none
    transitionSpeed: fast
    theme:           beige
    highlight:       espresso
    smart:           yes
    center:          no
    incremental:     no
    slide_level:     2
    fig_width:       5.5
    fig_height:      2.8
    fig_caption:     no
    self_contained:  no
    keep_md:         no
    reveal_plugins:  "notes"
    reveal_options:
      slideNumber:          yes
      previewLinks:         yes
      hash:                 yes
      pdfSeparateFragments: no
---

```{r setup, include=FALSE}
# TODO: Revisar dependencias

# Libraries:
library(pacman)
p_load(knitr, tidyverse, lubridate)


source("R/Output.R", encoding = 'UTF-8')

# TODO: Revisar configuraci√≥n

# Configuration:
opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, results = 'asis')
```

## Automatizaci√≥n de procesos de datos y documentaci√≥n

```{css styles, echo=FALSE}
.leftalign{
  text-align: left;
}

.reveal ul {
  display: block;
}

.reveal section img {
  background: none;
  border:     none;
  box-shadow: none;
}

.container {
  display:     flex;
  align-items: center;
}

.col {
  flex:       1;
  align-self: center;
}
```

```{r logo-ecs, out.width='25%', out.extra='style="border: 2px solid #015178;"'}
include_graphics(LOGO_ECS)
```

### "Variables outcome" con

::: {.container}
::: {.col}
```{r logo-stata}
include_graphics(LOGO_STATA)
```
:::

::: {.col}
```{r plus-icon, out.width='30%'}
include_graphics(ICON_PLUS)
```
:::

::: {.col}
```{r logo-rmd, out.width='50%'}
include_graphics(LOGO_RMARKDOWN)
```
:::
:::

##### Daniel Morillo (CiberSAM)

##### `r today() %>% format('%d de %B de %Y')`

`r section_title_slide("Introducci√≥n")`

# Procesar datos

<br>

Datos brutos -\> Variables "outcome"

<br>

::: {.fragment .leftalign}
Dataset:

-   Escribir sintaxis
:::

>-  Ejecutar sintaxis

>-  Depurar sintaxis

>-  Guardar dataset con outcomes

# Procesar datos

<br>

Datos brutos -\> Variables "outcome"

<br>

::: {.leftalign}
Documento "Description":
:::

> -   Copiar sintaxis a documento "Description"

> -   Escribir documento "Description"

> -   Guardar documento "Description"

::: {.notes}
A veces la sintaxis en el documento se escribe en paralelo a la ejecuci√≥n

Mucho trabajo manual
:::

# Procesar datos

<br>

**Problemas**

::: {.fragment .leftalign}
Integridad de datos:

<br>

-  Actualizaci√≥n
:::

<br>

> -   Control de conflictos

::: {.notes}
-   Actualizaci√≥n: Si cambian los datos de origen

-   Para evitar que haya versiones distintas de misma variable
:::

# Procesar datos

<br>

**Problemas**

::: {.fragment .leftalign}
Documentaci√≥n:

<br>

-  Control de versiones
:::

<br>

> -   Actualizaci√≥n

::: {.notes}
-   Versiones: Que represente el dataset que est√° generado verdaderamente

-   Actualizaci√≥n: Que se actualice siempre el documento junto con los datos
:::

# Procesar datos

<br>

**Problemas**

<br>

::: {.fragment}
Tiempo + Esfuerzo
:::

<br>

::: {.fragment}
Errores
:::

::: {.notes}
-   Repetir estos procesos requiere tiempo y esfuerzo

-   Cada vez que se hace un proceso manualmente,
aumenta la probabilidad de cometer errores.

-   Esos errores se propagan a "procesos posteriores"
(y tambi√©n hay que repetirlos despu√©s de corregir ese error)
:::

# Objetivos

<br>

::: {.leftalign}
> 1.  Aprender a usar Rmarkdown para automatizar tareas

<br>

> 2.  Aprender a ejecutar sintaxis de Stata en Rmarkdown

<br>

> 3.  Entender ventajas de la automatizaci√≥n

:::

::: {.notes}

(Quitado); Objetivo secundario, aprenderemos tambi√©n a utilizar un poco Rstudio
:::

# Qu√© vamos a hacer...

<br>

::: {.leftalign}
> 1.  Instalaci√≥n de entorno

<br>

> 2.  Creaci√≥n de documento `.Rmd`

<br>

> 3.  Edici√≥n del documento `.Rmd`

<br>

> 4.  Extras: Citas, automatizaci√≥n...
:::

# C√≥mo lo vamos a hacer...

<br>

> - Explicaciones

<br>

::: {.fragment}
- Ejercicios

`r exercise_item("Ejercicio:", fragment = TRUE)`
:::

::: {.notes}
Explicaciones (pocas)

Hay muchos ejercicios aplicados
:::

# C√≥mo lo vamos a hacer...

<br>

::: {.leftalign}
Reacciones:
:::

> -   üòê: Neutral (Reset)

> -   üëç: conseguido, todo listo, te sigo, vas muy lento...

> -   üòñ: me he perdido, tengo errores, m√°s despacio...

<br>

::: {.fragment .leftalign}
‚úã ¬°Ayuda!
:::

<!-- "Breakup" rooms; TODO: Comprobar si se puede-->

::: {.notes}
Reacciones: Activar encuesta Polly en el chat de la reuni√≥n

Explicar uso de Polly

-   Probar reacciones: empezar por neutra

-   Pedir a todo el mundo que cambie a pulgar

-   Pedir a todo el mundo que cambie a estr√©s

Ayuda: Pedir a todo el mundo que use "mano levantada"

(Comentar: Si dejan de verse las teclas en pantalla, "levantar mano")

"Mano levantada" permanece activa hasta que se desactiva
(no es como las reacciones que duran un rato y se quitan solas)

Una vez comprobado, pedir a todo el mundo que desactive la mano levantada
:::

`r section_title_slide("Instalaci√≥n del entorno")`

# Entorno

<br>

-   Stata

-   R

-   Rstudio

-   OneDrive (+ carpetas)

-   MS Word

<br>

> -   **(Opcional)**: Zotero

::: {.notes}
IMPORTANTE:

1.  Licencia de Stata funcional (probar a arrancar Stata)

2.  Comprobar la sincronizaci√≥n de las carpetas de OneDrive localmente (ruta puede ser distinta)

3.  Zotero: Pedir "OK", "No",
quien tenga Zotero y biblioteca instalados.
:::

# Preparaci√≥n

<br>

Ventanas:

> -   MS Teams

<br>

> -   Rstudio

<br>

> -   Stata

<br>

> -   Documento "prototipo"

::: {.notes}
Ventanas: Cerrar todo lo dem√°s, muy recomendable.
El motivo es que si no tenemos suficiente espacio en la pantalla,
vamos a tener que cambiar muy a menudo entre ventanas.

Si tenemos una pantalla grande podemos usar la tecla Windows
y las teclas de cursor para ordenar las ventanas en la pantalla.
:::

# Entorno de Rstudio

<br>

> -   Editor

::: {.fragment}
-  Int√©rprete de R:

<!-- TODO: Imagen consola? -->

(Comandos + Resultados)
:::

::: {.notes}
Mostrar ventana de Rstudio

- Editor: Ahora mismo est√° vac√≠o

- Consola: Comandos + resultados como la de Stata
:::

# Configuraci√≥n

<br>

::: {.leftalign}
Paquete `ecs.data`
:::

::: {.fragment}
`r exercise_item("Instalar paquete *ecs.data*:")`

```{.r}
source("`r URL_CONFIG_FILE`")
```
:::

::: {.notes}
Instalaci√≥n:

¬°¬°NO COPIAR C√ìDIGO A√öN!!

`ecs.data` == Edad con Salud

- Data. Funcionalidades para trabajar con datos de Edad con Salud.

1.  Mostrar instalaci√≥n del paquete: pegar en consola y ENTER

Explicar configuraci√≥n:

-   Comprobaciones: Dependencias CRAN ("oficiales"), Statamarkdown,
Stata (Aviso si no lo encuentra)

2.  Ejercicio:

IMPORTANTE: Usar "mano arriba" si se tienen problemas.

¬°¬°COPIAR Y PEGAR C√ìDIGO AHORA EN EL CHAT!!

EXPLICAR CONFIGURACI√ìN DE LAS CARPETAS:

-   Carpetas OneDrive: Configurar BDD,
Documentaci√≥n (configurar s√≥lo los de "Edad con Salud")
:::

# Crear proyecto

<br>

`r exercise_item("File -> New Project... -> New Directory:")`

-  Gesti√≥n de datos de "Edad con Salud"

-  Escribir "Directory name"

-  ¬øEjecutar configuraci√≥n?

::: {.notes}
Crear en home de usuario (o explicar en "OneDrive")

"Ejecutar configuraci√≥n" acabamos de hacerlo al instalar el paquete.

S√≥lo hace falta hacerlo una vez, as√≠ que lo dejamos en "Off" (por defecto)
:::

# Estructura del proyecto

<br>

Estructura de carpetas:

<!-- TODO: ejemplo √°rbol? -->

`r exercise_item('Explorar archivos (Pesta√±a "Files")')`

::: {.fragment}
`r exercise_item('Ver en explorador del SO:')`

- "More" -\> "Show Folder in New Window"
:::

::: {.notes}
Ver en explorador: "Se abre la carpeta en la que nos encontramos actualmente"
:::

# Atajos de teclado

<br>

Teclas importantes:

> -   `CTRL`

> -   `SHIFT` (May√∫s)

> -   `ALT`

> -   `ALT GR`

::: {.notes}
ATENCI√ìN: Comprobar que Carnac est√© activado!

- Es habitual usar el teclado para hacer tareas m√°s sencillas

- Voy a explicar c√≥mo el interfaz gr√°fico y tambi√©n c√≥mo usar el teclado,
aunque YO NO LO VOY A USAR.

- se mostrar√°n algunas combinaciones de teclas (atajos)

EXPLICAR: ¬øD√≥nde se encuentra cada una de las teclas?

√ânfasis en distinguir `ALT GR` (derecha de barra espciadora)
y `ALT` (izquierda)
:::

# Usar Rstudio

<br>

Atajos de teclado:

> -   `ALT` + `TAB`: Cambiar entre ventanas

> -   `CTRL` + `1`: Ir al editor

> -   `CTRL` + `2`: Ir a la consola

`r exercise_item("Probar los atajos de teclado", fragment = TRUE)`

::: {.notes}
Son combinaciones de teclas

Muy conocido: Usar y mostrar ejemplo de `CTRL` + `C` / `CTRL` + `V`

Ejercicio:

-   Probar `ALT` + `TAB` para cambiar de Teams a R
(forma r√°pida y sencilla, NO es un atajo de Rstudio sino de Windows)

Mostrar posici√≥n del cursor al pulsar `CTRL` + `1` y `CTRL` + `2`

`CTRL` + `1` y `CTRL` + `2` no funcionan con el teclado num√©rico (s√≥lo QUERTY)

Cuando terminen de probar: Darle a OK en Polly
:::

`r section_title_slide("Creaci√≥n de documento .Rmd") `

# Crear documento

<br>

Plantilla `.Rmd`:

<br>

`r exercise_item("Crear documento desde plantilla .Rmd")`

::: {.notes}
-   Ejercicio: Seguir instrucciones en README.md

-   Nombre archivo: ver punto 2 en "Consideraciones generales" (en la plantilla)

-   Si usas ejemplo "tipo" (cognition), a√±ade iniciales como "particularidad"

Estamos creando un documento a partir de una plantilla dise√±ada especialmente
para la generaci√≥n de las variables "outcome" de Edad con Salud.

El objetivo de este documento es generar **en un s√≥lo paso**,
y de forma autom√°tica,
el dataset con la/s variables outcome Y la documentaci√≥n.
:::

# Crear documento

<br>

Plantilla `.Rmd`:

`r exercise_item("Guardar:")`

-  `CTRL` + `S`

-  Carpeta: `doc/outcomes/cohorte_2019/ola_1/muestra_completa`

-  Nombre de archivo

# Generar "output"

<br>
<br>

<!-- TODO: Imagen Bot√≥n -->
-  Bot√≥n knit (`CTRL` + `SHIFT` + `K`)

<br>

-  Output en Word

::: {.notes}
Al generar el documento en Word se utilizan los estilos de una plantilla
de Word
:::

# Contenido de la plantilla

<br>

-  Tipos de c√≥digo

    -  yaml (encabezado)
    -  **markdown** / html
    -  R
    -  **Stata**

<br>

-  "Placeholders" (`<` ... `>`)

::: {.notes}
yaml: Encabezado; indica "c√≥mo hay que procesar el archivo"
(por ejemplo, generar Word como salida)

Markdown: "Texto" con formato (html es c√≥mo se escriben las p√°ginas web;
se puede usar para algunas cosas m√°s complicadas
que en Markdown no se pueden hacer)

R: Algo de configuraci√≥n (no hace falta editarlo, ni saber R)

Resaltado: No contempla Stata, ya que Rstudio no est√° dise√±ado para Stata.
:::

# Comentarios

<br>

::: {.fragment}
-   Stata  (Varios formatos)

    - `*`
    
    - `/*` ... `*/`
    
    - `//`
:::

<br>

> -  yaml / R: `#` (Ignora lo que est√° a la derecha)

<br>

> -  Markdown (html): `<!--` ... `-->` ("infijo")

# Comentarios

<br>
<br>

-  "TODO"s == Tareas a realizar

<br>

`r exercise_item("Editar t√≠tulo", fragment = TRUE)`

::: {.notes}
Comparar "TODO"'s en comentarios en yaml (l√≠nea 2) y markdown (l√≠nea 22)

La plantilla nos va a guiar sobre qu√© hacer mediante los
"TODO"s; a modo de ejemplo de c√≥mo proceder,
editamos el t√≠tulo y borramos el "TODO".
Borrando "TODO's" vamos dejando "limpio" el documento,
y sabemos que los "TODO's" que queden son cosas pendientes de hacer o resolver.

Ejercicio:

-   Editar t√≠tulo

-   Una vez editado el t√≠tulo, borrar el "TODO".
:::

`r section_title_slide("Edici√≥n del documento .Rmd") `

<!-- TODO: Icono ejercicio -->

::: {.notes}
En este momento, abrir documento "prototipo" si no se ha abierto ya
:::

# Editor visual

```{r, out.width='25%', out.height='20%'}
include_graphics(ICON_CONSTRUCTION)
```

<!-- TODO: bot√≥n? -->

> -   Activar (`CTRL` + `SHIFT` + `F4`)


`r exercise_item("Explorar men√∫s", fragment = TRUE)`

> -   M√°s info: `r URL_VISUAL_MD`

::: {.notes}
Editor visual est√° en "Experimental" pero es mejor usarlo
para facilitar la edici√≥n.

Se puede ver que lo que hace es "formatear" en la pantalla
el contenido (pero sin que deje de ser s√≥lo texto).
Lo que hace es "interpretarlo" para que lo veamos m√°s
parecido a como queremos que se genere en la salida
(p.ej. en negrita en lugar de entre asteriscos)

Podemos activarlo y desactivarlo cuando queramos para ver
el aspecto del documento "original".
:::

# Encabezado

<br>

-  T√≠tulo

-  Output (plantilla)

-  Bibliograf√≠a / estilos bibliogr√°ficos

-  Referencias "no citadas"

<br>

`r exercise_item("Leer y borrar 'consideraciones generales'", fragment = TRUE)`

::: {.notes}
Ahora vamos a ver todas las partes de las que consta
la plantilla.

-   Hay una l√≠nea `bibliography` adicional comentada.
Luego volveremos sobre ello.

Tambi√©n veremos el campo "no cite" m√°s adelante.

NOTA: Dar cr√©dito a Elvira por redacci√≥n del documento
de VV outcome.

Leer texto "Consideraciones generales". Una vez le√≠do y hecho, borrar.

NOTA: Adaptar variable: Tenemos que asegurarnos de que los
nombres de las variables est√°n corregidos para esta ola
y/o cohorte, adem√°s de asegurarnos de que la sintaxis
funciona.
:::

# Chunk de configuraci√≥n

<br>

- Delimitador de c√≥digo: \`\`\`

<br>

- Tipo de c√≥digo: `{r ...}`

<br>

- Nombre: `setup`

<br>

- Configuraci√≥n de "chunk"

::: {.notes}
√önico c√≥digo en R.

- Delmitador de c√≥digo, tres acentos inversos. No se muestra en editor visual

- A continuaci√≥n las llaves (c√≥digo a ejecutar)

- *configuraci√≥n del chunk*
(primero qui√©n debe interpretarlo (R); luego, "no incluir" el resultado).
:::

# Chunk de configuraci√≥n

<br>

- Librer√≠as

<br>

::: {.fragment}
`r exercise_item("Cargar librer√≠a *Statamarkdown*:")`

-   `ALT` + `ENTER`
:::

::: {.notes}
- Configuraci√≥n necesaria para ejecutar Stata (usar librer√≠a Statamarkdown)

Ejecutar para ver resultado: ponerse en la l√≠nea y pulsar `ALT` + `ENTER`.
Tambi√©n se puede escribir en la consola `find_stata()` y `ENTER`.

- Opciones para generar el documento (se ven a continuaci√≥n)

**Preguntar:** Si alguien ha tenido problemas con la configuraci√≥n de Stata
(no lo ha encontrado R).
Al ejecutar la l√≠nea o antes al configurar el paquete
:::

## Si no encuentra Stata...

<br>

:::{.fragment}
`r exercise_item("Encontrar Stata manualmente:")`

-   Ejecutar Stata

-   `sysdir`
:::

:::{.fragment .leftalign}
`r exercise_item("Editar c√≥digo R:")`

-   Objeto `STATA_PATH`

-   Configuraci√≥n del motor de Stata
:::

:::{.notes}
Congiguraci√≥n:

Objeto `STATA_PATH` (L√≠nea 22)

-   Dejar `r"(...)"`

-   Valor "character" (Almacena "texto")

Congiuraci√≥n del motor de Stata (Quitar almohadilla en la l√≠nea)

-   ¬°¬°Comprobar nombre del ejecutable!!
:::

# Chunk de configuraci√≥n

<br>

::: {.leftalign}
Configuraci√≥n de `knitr`:
:::

- `echo = FALSE`: NO incluir sintaxis

-   `results = 'hide'`: NO mostrar resultados

-   `cleanlog = TRUE`: NO repetir sintaxis en resultados de Stata

-   `collectcode = TRUE`: Reutiliza c√≥digo de Stata de un 'chunk' al siguiente

::: {.notes}
(Ahora vamos a explicar las opciones para generar el documento)

No modificar configuraci√≥n de `knitr` (excepto "engine.path" si se ha hecho)

-   `echo = FALSE`: NO incluir sintaxis de Stata en el documento.
Mostrar chunks de Stata que incluyen sintaxis que no interesa;
luego veremos c√≥mo incluimos la sintaxis de generaci√≥n de la variable
que s√≠ interesa.

-   `results = 'hide'`: No mostrar resultados

-   `cleanlog = TRUE`: No repetir sintaxis en resultados de Stata

-   `collectcode = TRUE`: Reutiliza c√≥digo de Stata de 'chunk' a 'chunk'
:::

# Tabla de informaci√≥n de variables

<br>

- Formato [*grid table*](`r URL_PANDOC_GRID_TABLE`):

::: {.fragment}
`r exercise_item("Completar tabla de informaci√≥n de variables:")`

-   Copiar "Variable information" de prototipo

-   Eliminar comentarios y ejemplos

-   Eliminar "TODO"'s
:::

::: {.notes}
Tabla "rejilla" o "grid table": Se puede "desactivar" el editor visual
para ver c√≥mo est√° representada mediante caracteres (en Markdown)
:::

# Texto (Markdown)

<br>
<br>

-   Salto de l√≠nea: `<br>`

<br>

> -   Variable description

<br>

> -   Explanation of how the variables were created

# Texto (Markdown)

<br>

`r exercise_item("Completar:")`

-  Copiar "variable description" y "explanation" de prototipo

-  Eliminar comentarios

-  Eliminar "TODO"'s

::: {.notes}
Copiar tal cual del documento prototipo

(Si hay referencias pegarlas tal cual de momento en el markdown, no mencionar)
:::

# Chunk inicial de Stata

<br>
<br>

- Tipo de c√≥digo: `{stata}`

<br>

- Nombre: `load-data`

::: {.notes}
-   Entre llaves: Indica "c√≥digo a ejecutar" en el chunk (stata)

-   Configuraci√≥n: Recordar que no se muestra la sintaxis de este chunk
porque en el chunk de configuraci√≥n `echo = FALSE`.
:::

# Chunk inicial de Stata

<br>

::: {.leftalign}
Comando `use`: `r URL_USE_COMMAND_STATA`
:::

::: {.fragment}
`r exercise_item("Archivo de BDD a utilizar")`

-  Elegir Cohorte

-  "Descomentar" (borrar `*` inicial)

-  Eliminar no utilizados
:::

::: {.notes}
Fijarse en que cuando abrimos un archivo de datos en Stata se ejecuta el
comando `use`.

Por qu√© usar `use`:

-   Usa "datos originales" (No versi√≥n posiblemente "manipulada"): Aseguramos
"provenancia" de datos (trazabilidad)

-   Evitar "proceso manual": copiar archivo a nueva ubicaci√≥n o "abrir archivo"
en sesi√≥n de Stata (evitamos posibles errores)

-   Generar "outcome dataset" con *la misma sintaxis de la descripci√≥n*

De esta manera podemos tener la certeza de que lo que hay en el dataset es
exactamente el resultado de ejecutar la sintaxis que aparece en el documento de
descripci√≥n: COINCIDEN Sintaxis y resultado.

Ruta de archivo:

-   "Home" de usuario (`~`): `ALT GR` + 4

    -   V√°lido para cualquier usuario

    -   `path.expand("~")` -\> Ruta absoluta

    -   "Home" seg√∫n Windows: `Sys.getenv("HOME")`

        -   Nivel arriba: `../`

    -   "Home" seg√∫n Stata (??)

-   Extensi√≥n de archivo

    -   `.dta` (Formato Stata): Incluir **siempre**
    -   Activar extensiones de archivo en Windows
:::

# Chunk *principal*

<br>

- Configuraci√≥n:

    - Reutiliza `load-data`
    
    - `echo=TRUE`

:::{.fragment}
`r exercise_item("Escribir sintaxis:")`

-   Copiar sintaxis de prototipo

-   Eliminar "TODO"'s
:::

::: {.notes}
IMPORTANTE: `echo=TRUE` hace que salga el c√≥digo en el documento.

Reutiliza `load-data` porque aparece `collectcode=TRUE`
en la configuraci√≥n general.

Esto es como incluir el `use` en este chunk, pero sin que aparezca
en la sintaxis (as√≠ queda "limpia" con los comandos que se necesitan
para generar esta variable outcome, i.e.
lo que tendr√≠a que copiar alguien que quisiera reutilizar esta sintaxis
para generar la misma variable en otra ola)

Sintaxis: Normalmente, abriremos el dataset en Stata,
e iremos escribiendo y probando la sintaxis.
En este caso, podemos simplemente abrir nuestro documento prototipo
y copiar y pegar la sintaxis para ejecutarla y asegurarnos
de que hace lo que queremos.

Despu√©s la pegamos en el documento `.Rmd`,
igual que la pegar√≠amos en el documento Word.

La diferencia es que aqu√≠ no vamos a guardar el dataset resultante
de ejecutar la sintaxis en la consola de Stata.
S√≥lo nos va a interesar por ahora tener
la sintaxis en el documento de descripci√≥n.
:::

# Chunk de *descriptivos*

<br>

- Configuraci√≥n

:::{.fragment}
`r exercise_item("Completar sintaxis:")`

-   Copiar de prototipo o escribir:

    - `sum`: vv. cuantitativas
  
    - `codebook` (opcional) & `tab`: vv. categ√≥ricas

-   Eliminar "TODO"
:::

::: {.notes}
Tabla de descriptivos: incluimos sintaxis en el output (`cleanlog=FALSE`),
en formato markup
(`results='markup'` hace que salga como texto con las almohadillas delante)

y `collectcode=FALSE`: no necesario para despu√©s ("save")
ya que da igual que est√©n o no calculados los descriptivos.
Evitamos "ejecutarlo dos veces", una en este chunk y otra en el siguiente,
ahorrando un poco de tiempo de ejecuci√≥n.

Descriptivos: Si no se han hecho, hacer lo siguiente:

-   `codebook` (opcionalmente) para comprobar que las etiquetas
y niveles son correctos

-   `sum` si la variable es cuantitativa

-   `tab` si la variable es categ√≥rica
:::

# Chunk de *guardado*

<br>

::: {.leftalign}
Comando `keep`: `r URL_KEEP_COMMAND_STATA`
:::

<br>

`r exercise_item("Incluir variables generadas", fragment = TRUE)`

# Chunk de *guardado*

<br>

::: {.leftalign}
Commando `save`: `r URL_SAVE_COMMAND_STATA`
:::

<br>

:::{.fragment}
`r exercise_item("Rellenar:")`

- Seleccionar cohorte / Ola

- Sustituir "variable" y "qualifier"

- Borrar sintaxis no utilizada
:::

::: {.notes}
Comando `keep`: Explicar variables de apoyo

Commando `save`: Por ahora **escribir en local**
(comentar ruta de carpeta de salida y crear l√≠nea nueva con
"ruta relativa a la ubicaci√≥n del documento actual")

Comillas: Hace que la ruta entera se considere un √∫nico valor de
"cadena de texto" (si hay espacio no habr√° problemas). USAR SIEMPRE.

`, replace`: Fijarse en la coma inicial. Es necesario si queremos
que se sobreescriba el archivo con el dataset cuando
se vuelva a generar el documento
:::

# Informaci√≥n de contacto

`r exercise_item("Completar:")`

<br>

- Sustituir "placeholders"

<br>

- "Original version" (Completar / borrar ?)

# Session info

<br>
<br>

- Configuraci√≥n: `results='markup'`

<br>

- *Reproducibilidad*

::: {.notes}
Nos saltamos "References" (luego volvemos sobre ello)

C√≥digo R (adem√°s de "setup")

Configuraci√≥n: hace que salga como "texto" con las almohadillas delante.

Es importante incluirlo por "reproducibilidad".
Si quien intente usar esta sintaxis encuentra diferencias,
puede comparar el entorno de quien gener√≥ la versi√≥n original
(paquetes, versi√≥n de R, Sistema Operativo, etc.)
con el suyo.

NO es suficiente: Versi√≥n de Stata por ejemplo no aparece.
Por eso en ese caso hay que indicarlo (e.g. Stata 15)
en el t√≠tulo de la secci√≥n "Syntax used to create the variable"
:::

# Output final

<br>

`r exercise_item("Generar documento final:")`

<br>

- Documento "description"

<br>

- Dataset

::: {.notes}
Bot√≥n knit √≥ `CTRL` + `SHIFT` + `K`

Resultado: Se han generado dos "outputs"

-   Documento Word: Chunk "Descriptivos" (running ... do ...)
se debe al `collectcode=TRUE`,
que crea un archivo `.do` con el c√≥digo anterior
y lo ejecuta antes de este chunk.

-   Dataset (en misma carpeta que el documento
porque hemos cambiado la ruta de salida).
:::

`r section_title_slide("Extras")` <!-- TODO: Imagen herramientas? -->

# Referencias

<br>

::: {.leftalign}
**Opciones:**
:::

<br>

::: {.leftalign}
> 1.  Incluir manualmente

<br>

> 2.  Usar gestor bibliogr√°fico
:::

::: {.notes}
Preguntar qui√©n tiene instalado Zotero y la bibliograf√≠a de Edad con Salud
(Dar a OK en Polly)
:::

## Incluir manualmente

<br>

::: {.fragments}
`r exercise_item('Copiar secci√≥n "referencias" de prototipo')`

<br>

- Borrar p√°rrafo y "TODO"

<br>

- Borrar delimitador de secci√≥n
:::

::: {.notes}
-   Problema: No se actualiza autom√°ticamente

-   No aplica los estilos de texto y p√°rrafo
:::

# Usar gestor bibliogr√°fico

<br>

::: {.leftalign}
Delimitador "refs"
:::

<br>

`r exercise_item('Borrar p√°rrafos antes y despu√©s', fragment = TRUE)`

# Usar gestor bibliogr√°fico

<br>

`r exercise_item("Definir fuente:")`

<br>

- Modificar ruta al archivo de bibliograf√≠a

<br>

- Tools -\> Project Options... -\> Rmarkdown

# Usar gestor bibliogr√°fico

<br>

::: {.leftalign}
[Insertar citas](`r URL_CITATION_SYNTAX`)
:::

::: {.fragment}
`r exercise_item("Completar citas")`

- `CTRL` + `SHIFT` + `F8`: Insertar cita <!-- TODO: Bot√≥n cita -->

<br>

> - Referencias no citadas
:::

::: {.notes}
Delimitador: Inserta autom√°ticamente referencias citadas.
Formato APA: usando el archivo csl definido.

Configurar fuentes:

1.  Abrir Zotero, asegurarse de que "Edad con Salud" est√° sincronizada.

2.  Ir a Tools -\> Project Options... -\> Rmarkdown -\> Visual Mode: Zotero

3.  Seleccionar "Selected Libraries" en desplegable "Use libraries"

4.  Click en "Edad con Salud"

5.  Click en "OK"

Cambiar ruta al archivo de bibliograf√≠a:
Por desgracia no funciona con el autom√°tico en R,
hay que cambiar e incluirlo manualmente (modificar en el encabezado).
Pero hay que tener en cuenta que la ruta est√© bien puesta al archivo,
ver bien el n√∫mero de "niveles" que hay que subir.

Completar citas:

-   Susituir las citas manuales, usando bot√≥n citar
[\@], o `CTRL` + `SHIFT` + `F8`

A medida que a√±adimos citas, se a√±aden al `.bib` que estamos usando (mostrar)

Tambi√©n, si se quiere incluir una referencia "no citada", se puede en el
campo 'nocite' del encabezado.

El problema es que no se incluye en el `.bib`
autom√°ticamente.
El truco ser√≠a "meterla en el texto" y luego
borrarla.
:::

# Usar gestor bibliogr√°fico

<br>

::: {.leftalign .fragment}
Crear archivo `.bib`:
:::

> - Desde Zotero

> - Desde EndNote: `r URL_BIBTEX_EXPORT_ENDNOTE`

> - Desde Mendeley: `r URL_BIBTEX_EXPORT_MENDELEY`

::: {.notes}
Ventajas del gestor bibliogr√°fico

- No se nos olvidan citas

- Podemos cambiar f√°cilmente el estilo

Se puede crear el `.bib` manualmente, exportando desde Zotero, y despu√©s
buscar los c√≥digos de registro y copiar y pegar en el documento Rmarkdown.

Tambi√©n se puede exportar en `.bib` desde otros gestores bibliogr√°ficos.
:::

`r section_title_slide("Herramientas")`

<br>

```{r, out.width='25%'}
include_graphics(ICON_CONSTRUCTION)
```

# Herramientas

<br>

> -   SPSS a Stata

<br>

> -   Generar outcomes:

::: {.fragment}
`r exercise_item("Regenerar outcomes / documentos")`

- Cambiar ruta del dataset

- Seleccionar archivo(s) y "modo"
:::

::: {.notes}
En men√∫ "Addins", bajo "ecs.data", ambas herramientas.

- SPSS a Stata: Seleccionar ruta de archivo SPSS (ense√±ar sin entrar en detalle)

Queda una cosa:
El documento y el dataset se crean en la carpeta
del proyecto, y habr√≠a que moverlos "a mano"
(queremos evitar pasos manuales).
Vamos a usar una herramienta autom√°tica:

Generar outcomes:

Regenerar outcomes / documentos

1. Cambiar ruta de salida del fichero con el dataset por su ola correspondiente

2. Usar gadget, seleccionando los documentos a "knitear"

   -   Probar con seleccionar carpeta, o bien "seleccionar varios archivos"

   -   Ver opciones en funci√≥n de fecha

   -   Repetir: Modificar archivo ligeramente y probar opciones de "fecha"
:::

`r section_title_slide("Conclusiones")`

# Resumen

<br>

::: {.leftalign}
> 1. Crear documentaci√≥n en Rmarkdown (con Stata)

<br>

> 2. Generar dataset y documentaci√≥n **en un s√≥lo paso**

<br>

> 3. Repetir eliminando trabajo manual
:::

::: {.notes}
- Este paso requiere todo el esfuerzo por nuestra parte

- El propio documento se "ejecuta" generando dataset y documentaci√≥n

- Repetir s√≥lo implica un paso con trabajo manual m√≠nimo (pero no cambiar nada
de lo ya hecho y escrito)
:::

# Conclusiones

<br>

> - Dataset y documentaci√≥n **en el mismo paso**

<br>

> - Evitar duplicar trabajo repetitivo

<br>

> - Reducir tareas manuales

::: {.notes}
- Evitar conflictos de versiones entre ambos

- Evitar tiempo, esfuerzo y frustraci√≥n

- Reducir posibilidad de errores
:::

# A continuaci√≥n...

<br>

- ¬øMejoras en las plantillas?

- ¬øOportunidades de pr√°ctica y aprendizaje?

- ¬øMejoras en las herramientas de automatizaci√≥n?

- ¬øNuevas funcionalidades?

- ¬øReestructuraci√≥n de la estructura de archivos?

`r section_title_slide("FIN")`

<br>

<br>

*¬°Gracias por vuestra atenci√≥n!*

`r section_title_slide("Chuletas")`

# Enlaces

<small class="leftalign">

Markdown:

-   [Editor visual de Rstudio](`r URL_VISUAL_MD`)

-   [Sintaxis grid tables](`r `URL_PANDOC_GRID_TABLE`)

Comandos de Stata:

-   [`use`](`r URL_USE_COMMAND_STATA`)

-   [`keep`](`r URL_KEEP_COMMAND_STATA`)

-   [`save`](`r URL_SAVE_COMMAND_STATA`)

Referencias:

-   [Sintaxis de citas en Markdown](`r URL_CITATION_SYNTAX`)

-   [Exportar `.bib` desde EndNote](`r URL_BIBTEX_EXPORT_ENDNOTE`)

-   [Exportar `.bib` desde Mendeley](`r URL_BIBTEX_EXPORT_MENDELEY`)

</small>

# Atajos de teclado (Windows)

<br>

-   `ALT` + `TAB`: Cambiar entre ventanas de Windows

-   `CTRL` + `1`: Ir al editor

-   `CTRL` + `2`: Ir a la consola

-   `CTRL` + `S`: Guardar archivo / guardar cambios

-   `CTRL` + `SHIFT` + `F4`: Activar editor visual

-   `ALT` + `ENTER`: Ejecutar comando en R

-   `CTRL` + `ENTER`: Ejecutar comando en R y siguiente

-   `CTRL` + `SHIFT` + `K`: "Knitear" documento

-   `CTRL` + `SHIFT` + `F8`: Insertar cita

# Rutas de archivo

<br>

-   Absoluta = "path" completo

<br>

-   Relativa = "path" relativo a un archivo

<br>

-   Home de usuario: `~`

<br>

-   Subir un nivel: `../`

# Atribuciones

::: {.container}
::: {.col style="width:20%"}
`r img(alt = "Logo Rmarkdown", src = LOGO_RMARKDOWN, height = 70)`
:::
::: {.col style="width:80%"}
[Rstudio.com](`r URL_LOGO_RMD`)
:::
:::

::: {.container}
::: {.col style="width:20%"}
`r img(alt = "Logo Stata", src = LOGO_STATA, height = 32)`
:::
::: {.col style="width:80%"}
[Stata.com](`r URL_LOGO_STATA`)
:::
:::

::: {.container}
::: {.col style="width:20%"}
`r img(alt = "Plus sign image", src = ICON_PLUS, height = IMG_HEIGHT_ATTR)`
:::
::: {.col style="width:80%"}
[GetDrawings.com](`r URL_ICON_PLUS`)
:::
:::

::: {.container}
::: {.col style="width:20%"}
`r img(alt = "'Under construction' icon", src = ICON_CONSTRUCTION, height = 75)`
:::
::: {.col style="width:80%"}
[Icons8.com](`r URL_ICON_CONSTRUCTION`)
:::
:::

::: {.container}
::: {.col style="width:20%"}
`r img(alt = "'Exercise' icon", src = ICON_EXERCISE, height = IMG_HEIGHT_ATTR)`
:::
::: {.col style="width:80%"}
[Icons8.com](`r URL_ICON_EXERCISE`)
:::
:::
